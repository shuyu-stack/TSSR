# Supervision et Monitoring Infrastructure

> **Module :** Emploi Technicien Exploitation
> **Date :** Janvier 2026
> **Niveau :** N0-N1
> **Prérequis :** Bases réseau, Windows Server

---

## Pourquoi ce cours ?

En centre de services / NOC, tu passes **80% de ton temps** devant des écrans de supervision. Tu dois comprendre ce que tu regardes, sinon tu es aveugle.

---

## C'est quoi la supervision ?

```
┌─────────────────────────────────────────────────────────────┐
│                    LA SUPERVISION EN 30 SECONDES            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  SUPERVISION = Surveiller l'état de l'infrastructure IT     │
│                                                              │
│  On surveille :                                              │
│  • Les SERVEURS (CPU, RAM, disque, services)                │
│  • Le RÉSEAU (switches, routeurs, bande passante)           │
│  • Les APPLICATIONS (disponibilité, temps de réponse)       │
│  • Les BASES DE DONNÉES (connexions, requêtes)              │
│                                                              │
│  Objectif : Détecter les problèmes AVANT les utilisateurs   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### Le principe : les métriques et les seuils

```
┌─────────────────────────────────────────────────────────────┐
│                    MÉTRIQUE + SEUIL = ALERTE                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  MÉTRIQUE : Une valeur mesurable                            │
│  Exemple : CPU du serveur SRV-WEB-01 = 45%                  │
│                                                              │
│  SEUIL : La limite acceptable                               │
│  Exemple : Seuil WARNING = 80%, Seuil CRITICAL = 95%        │
│                                                              │
│  ALERTE : Déclenchée quand métrique > seuil                 │
│  Exemple : CPU à 96% → ALERTE CRITICAL                      │
│                                                              │
│         0%      50%      80%       95%     100%             │
│          │───────│────────│─────────│────────│              │
│          │  OK   │   OK   │ WARNING │CRITICAL│              │
│          │ vert  │  vert  │  orange │  rouge │              │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## Les outils de supervision

### Vue d'ensemble

| Outil | Type | Usage | Licence |
|-------|------|-------|---------|
| **Nagios** | Infrastructure | Le classique, très répandu | Open Source |
| **Centreon** | Infrastructure | Basé sur Nagios, interface moderne | Open Source |
| **Zabbix** | Infrastructure + Apps | Complet, auto-découverte | Open Source |
| **PRTG** | Infrastructure | Simple, Windows-friendly | Commercial |
| **Datadog** | Cloud/SaaS | Moderne, métriques + logs | Commercial |
| **Grafana** | Visualisation | Dashboards, fonctionne avec tout | Open Source |
| **Prometheus** | Métriques | Cloud-native, Kubernetes | Open Source |

### Nagios / Centreon

C'est le **standard historique** en entreprise. Tu le verras partout.

```
┌─────────────────────────────────────────────────────────────┐
│                    INTERFACE NAGIOS/CENTREON                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  DASHBOARD PRINCIPAL                                         │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  HOSTS        UP: 145   DOWN: 2   UNREACHABLE: 0    │    │
│  │  SERVICES     OK: 892   WARN: 12  CRIT: 5   UNK: 1  │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
│  ALERTES EN COURS                                            │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ CRITICAL │ SRV-DB-01    │ Disk /var 98%            │    │
│  │ CRITICAL │ SRV-WEB-03   │ HTTP CRITICAL - Timeout  │    │
│  │ WARNING  │ SRV-APP-02   │ CPU 85%                  │    │
│  │ WARNING  │ SW-CORE-01   │ Port Gi0/24 DOWN         │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
│  ÉTATS DES HOSTS                                             │
│  ● SRV-WEB-01    UP     │  ● SRV-DB-01     UP              │
│  ● SRV-WEB-02    UP     │  ○ SRV-DB-02     DOWN            │
│  ○ SRV-WEB-03    DOWN   │  ● SRV-APP-01    UP              │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**États possibles :**

| État | Couleur | Signification |
|------|---------|---------------|
| **UP / OK** | Vert | Tout va bien |
| **WARNING** | Orange | Attention, seuil d'alerte atteint |
| **CRITICAL** | Rouge | Problème grave, action requise |
| **DOWN** | Rouge | Host injoignable |
| **UNKNOWN** | Gris | Impossible de déterminer l'état |
| **PENDING** | Bleu | En attente de première vérification |
| **ACKNOWLEDGED** | Bleu foncé | Pris en compte par un technicien |

### Zabbix

Plus moderne, avec auto-découverte des équipements.

```
┌─────────────────────────────────────────────────────────────┐
│                    CONCEPTS ZABBIX                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  HOST         = Machine supervisée (serveur, switch, etc.)  │
│  ITEM         = Métrique collectée (CPU, RAM, etc.)         │
│  TRIGGER      = Condition qui déclenche une alerte          │
│  ACTION       = Ce qui se passe quand le trigger est actif  │
│  TEMPLATE     = Modèle de supervision réutilisable          │
│                                                              │
│  EXEMPLE :                                                   │
│  Host: SRV-WEB-01                                           │
│  └── Template: Template OS Linux                            │
│      └── Item: CPU utilization                              │
│          └── Trigger: CPU > 90% for 5 minutes               │
│              └── Action: Send email to support@...          │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### Grafana

C'est l'outil de **visualisation**. Il ne collecte pas de données, il les affiche.

```
┌─────────────────────────────────────────────────────────────┐
│                    DASHBOARD GRAFANA                         │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────────┐  ┌──────────────────┐                 │
│  │    CPU Usage     │  │   Memory Usage   │                 │
│  │    ▄▄▄▄█████     │  │   ████████▄▄▄   │                 │
│  │    45% avg       │  │   78% avg        │                 │
│  └──────────────────┘  └──────────────────┘                 │
│                                                              │
│  ┌──────────────────────────────────────────┐               │
│  │           Network Traffic                 │               │
│  │  IN:  ═══════════════════                │               │
│  │  OUT: ══════════                         │               │
│  │       0    50    100   150   200 Mbps    │               │
│  └──────────────────────────────────────────┘               │
│                                                              │
│  ┌──────────────────────────────────────────┐               │
│  │           Response Time (ms)              │               │
│  │     ╱╲    ╱╲                              │               │
│  │    ╱  ╲  ╱  ╲    ╱╲                       │               │
│  │ ──╱    ╲╱    ╲──╱  ╲──                    │               │
│  │  0    5    10   15   20   25  (minutes)  │               │
│  └──────────────────────────────────────────┘               │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## Les métriques essentielles à surveiller

### Serveurs

```
┌─────────────────────────────────────────────────────────────┐
│              MÉTRIQUES SERVEUR ESSENTIELLES                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  CPU                                                         │
│  • Usage global (%)                                         │
│  • Load average (Linux)                                     │
│  • Seuils typiques : WARNING 80%, CRITICAL 95%             │
│                                                              │
│  MÉMOIRE (RAM)                                              │
│  • Usage (%)                                                │
│  • Swap utilisé                                             │
│  • Seuils typiques : WARNING 85%, CRITICAL 95%             │
│                                                              │
│  DISQUE                                                      │
│  • Espace utilisé (%)                                       │
│  • I/O (lectures/écritures par seconde)                    │
│  • Seuils typiques : WARNING 80%, CRITICAL 90%             │
│                                                              │
│  SERVICES                                                    │
│  • État du service (running/stopped)                        │
│  • Port ouvert (TCP check)                                  │
│  • Temps de réponse                                         │
│                                                              │
│  RÉSEAU                                                      │
│  • Bande passante (Mbps)                                    │
│  • Erreurs d'interface                                      │
│  • Latence (ping)                                           │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### Applications Web

```
┌─────────────────────────────────────────────────────────────┐
│              MÉTRIQUES APPLICATION WEB                      │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  DISPONIBILITÉ                                               │
│  • HTTP Status Code (200 = OK, 500 = erreur serveur)       │
│  • Certificat SSL (expiration)                              │
│                                                              │
│  PERFORMANCE                                                 │
│  • Temps de réponse (ms)                                    │
│  • Time To First Byte (TTFB)                               │
│  • Requêtes par seconde                                     │
│                                                              │
│  ERREURS                                                     │
│  • Taux d'erreur 5xx (%)                                   │
│  • Taux d'erreur 4xx (%)                                   │
│                                                              │
│  SEUILS TYPIQUES :                                          │
│  • Temps réponse : WARNING 2s, CRITICAL 5s                 │
│  • Disponibilité : CRITICAL si != 200                      │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## Comment réagir à une alerte ?

### Le workflow standard

```
┌─────────────────────────────────────────────────────────────┐
│              WORKFLOW TRAITEMENT D'ALERTE                   │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. ALERTE REÇUE                                            │
│     │                                                        │
│     ▼                                                        │
│  2. IDENTIFIER                                               │
│     • Quel host/service ?                                   │
│     • Quelle criticité ?                                    │
│     • Depuis quand ?                                        │
│     │                                                        │
│     ▼                                                        │
│  3. ACKNOWLEDGE (Acquitter)                                 │
│     • Signaler que tu prends en charge                      │
│     • Stoppe les notifications répétées                     │
│     │                                                        │
│     ▼                                                        │
│  4. CRÉER LE TICKET                                         │
│     • Référencer l'alerte                                   │
│     • Décrire le symptôme                                   │
│     │                                                        │
│     ▼                                                        │
│  5. CHERCHER LA FICHE CONSIGNE                              │
│     • Base de connaissances / Wiki                          │
│     • Procédure associée à cette alerte                     │
│     │                                                        │
│     ▼                                                        │
│  6. APPLIQUER LA PROCÉDURE                                  │
│     • Suivre les étapes                                     │
│     • Documenter dans le ticket                             │
│     │                                                        │
│     ▼                                                        │
│  7. VÉRIFIER LA RÉSOLUTION                                  │
│     • L'alerte est-elle passée en OK ?                      │
│     • Si non → Escalader                                    │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### Exemple concret

```
ALERTE : CRITICAL - SRV-WEB-01 - Disk /var 95%

1. IDENTIFIER
   → Serveur web de production
   → Criticité haute (production)
   → Alerte depuis 10 minutes

2. ACKNOWLEDGE
   → Je clique "Acknowledge" dans Centreon
   → Commentaire : "Prise en charge par [mon nom]"

3. CRÉER TICKET
   → INC0012345 : Disque /var plein sur SRV-WEB-01

4. FICHE CONSIGNE
   → Je cherche "disk full" dans Confluence
   → Je trouve : PROC-SRV-001 - Libérer espace disque

5. APPLIQUER
   → La procédure dit :
     a) Vérifier les logs volumineux
     b) Purger les logs > 7 jours
     c) Vérifier les fichiers tmp

6. VÉRIFIER
   → L'alerte passe en WARNING (85%) puis OK (72%)
   → Je documente dans le ticket
   → Je clôture le ticket
```

---

## Les différents types d'alertes

### Par criticité

| Niveau | Action attendue | Délai |
|--------|-----------------|-------|
| **CRITICAL** | Action immédiate | < 15 min |
| **WARNING** | Surveillance, action planifiée | < 4h |
| **UNKNOWN** | Investigation | < 1h |

### Par type

```
┌─────────────────────────────────────────────────────────────┐
│                    TYPES D'ALERTES                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ALERTE INFRASTRUCTURE                                       │
│  • Serveur DOWN                                             │
│  • Disque plein                                             │
│  • CPU/RAM saturé                                           │
│  → Action : Vérifier le serveur, redémarrer si nécessaire  │
│                                                              │
│  ALERTE RÉSEAU                                               │
│  • Switch/routeur DOWN                                      │
│  • Port DOWN                                                │
│  • Latence élevée                                           │
│  → Action : Vérifier connectivité, contacter réseau        │
│                                                              │
│  ALERTE APPLICATION                                          │
│  • Service arrêté                                           │
│  • Temps de réponse élevé                                   │
│  • Erreurs HTTP 5xx                                         │
│  → Action : Redémarrer service, vérifier logs              │
│                                                              │
│  ALERTE SÉCURITÉ                                             │
│  • Tentatives de connexion échouées                        │
│  • Trafic anormal                                           │
│  • Fichier modifié                                          │
│  → Action : Escalader à la sécurité immédiatement          │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## Commandes utiles pour le diagnostic

### Vérifier un serveur Linux à distance

```bash
# Connexion SSH
ssh admin@srv-web-01

# Vérifier l'espace disque
df -h

# Vérifier CPU et mémoire
top -bn1 | head -20
free -h

# Vérifier les logs récents
tail -100 /var/log/syslog
tail -100 /var/log/messages

# Vérifier un service
systemctl status nginx
systemctl status apache2

# Redémarrer un service
sudo systemctl restart nginx
```

### Vérifier un serveur Windows à distance (PowerShell)

```powershell
# Espace disque
Get-WmiObject -ComputerName "SRV-WEB-01" -Class Win32_LogicalDisk |
    Where-Object { $_.DriveType -eq 3 } |
    Select-Object DeviceID, @{n='%Libre';e={[math]::Round($_.FreeSpace/$_.Size*100,2)}}

# CPU
Get-WmiObject -ComputerName "SRV-WEB-01" -Class Win32_Processor |
    Select-Object LoadPercentage

# Mémoire
Get-WmiObject -ComputerName "SRV-WEB-01" -Class Win32_OperatingSystem |
    Select-Object @{n='RAM_Used_GB';e={[math]::Round(($_.TotalVisibleMemorySize - $_.FreePhysicalMemory)/1MB,2)}}

# Services
Get-Service -ComputerName "SRV-WEB-01" -Name "W3SVC" | Select-Object Status

# Redémarrer un service
Get-Service -ComputerName "SRV-WEB-01" -Name "W3SVC" | Restart-Service
```

### Tests réseau

```powershell
# Ping
Test-Connection -ComputerName "SRV-WEB-01" -Count 4

# Test port
Test-NetConnection -ComputerName "SRV-WEB-01" -Port 443

# Traceroute
Test-NetConnection -ComputerName "SRV-WEB-01" -TraceRoute
```

---

## Exercice pratique

### Scénario

Tu reçois ces alertes sur ton écran de supervision :

```
08:15 CRITICAL  SRV-DB-01      Disk /data 98%
08:17 WARNING   SRV-WEB-02     CPU 87%
08:18 CRITICAL  SRV-WEB-01     HTTP CRITICAL - Connection refused
08:20 WARNING   SW-CORE-01     Interface Gi0/12 DOWN
```

**Questions :**

1. Dans quel ordre traites-tu ces alertes ?
2. Quelles actions immédiates pour chaque alerte ?
3. Lesquelles nécessitent une escalade ?

<details>
<summary>Solution</summary>

**1. Ordre de traitement :**

1. **SRV-WEB-01 HTTP** - CRITICAL + impact utilisateurs (web)
2. **SRV-DB-01 Disk** - CRITICAL + risque de crash base de données
3. **SW-CORE-01 Interface** - WARNING mais peut impacter plusieurs services
4. **SRV-WEB-02 CPU** - WARNING seulement

**2. Actions immédiates :**

- **SRV-WEB-01** : Vérifier si le service web tourne, le redémarrer
- **SRV-DB-01** : Identifier les fichiers volumineux, purger les logs
- **SW-CORE-01** : Vérifier quel équipement est sur ce port, escalader réseau
- **SRV-WEB-02** : Identifier le processus qui consomme, surveiller

**3. Escalades :**

- **SW-CORE-01** → Escalade équipe réseau (switch = pas ton périmètre N1)
- **SRV-WEB-01** → Si redémarrage service ne fonctionne pas → Escalade N2
- **SRV-DB-01** → Si pas de fichiers à purger évidents → Escalade DBA

</details>

---

## Checklist de révision

- [ ] Je comprends ce qu'est une métrique et un seuil
- [ ] Je connais les états possibles (OK, WARNING, CRITICAL, DOWN)
- [ ] Je sais lire un dashboard de supervision
- [ ] Je connais le workflow de traitement d'une alerte
- [ ] Je sais faire un diagnostic basique (disque, CPU, services)
- [ ] Je sais quand escalader

---

<div align="center">

**Cours suivant :** [Outils Atlassian (JIRA/Confluence)](./02-outils-atlassian.md)

[Retour au sommaire](./README.md)

</div>
